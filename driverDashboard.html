<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DriveWise - Driver Dashboard</title>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800&display=swap"
      rel="stylesheet"
    />
    <!-- Animate.css -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <style>
      :root {
        --primary: #4361ee;
        --primary-dark: #3a56d4;
        --secondary: #3f37c9;
        --accent: #4895ef;
        --dark: #1a1a2e;
        --light: #f8f9fa;
        --success: #4cc9f0;
        --warning: #f8961e;
        --danger: #f72585;
        --gray: #6c757d;
        --dark-gray: #343a40;
        --sidebar-width: 280px;
        --header-height: 70px;
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --accent-color: #f39c12;
        --dark-color: #2c3e50;
        --light-color: #ecf0f1;
        --success-color: #27ae60;
        --danger-color: #e74c3c;
        --border-radius: 12px;

        /* New gradient variables */
        --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        --gradient-accent: linear-gradient(135deg, #4895ef 0%, #4cc9f0 100%);
        --gradient-danger: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
        --gradient-success: linear-gradient(135deg, #4cc9f0 0%, #38b000 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: #f5f7fa;
        color: #333;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Dashboard Layout */
      .dashboard {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar Styles */
      .sidebar {
        width: var(--sidebar-width);
        background: linear-gradient(180deg, #1a1a2e, #16213e);
        color: white;
        position: fixed;
        height: 100vh;
        transition: all 0.3s ease;
        z-index: 100;
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
      }

      .sidebar-header {
        padding: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .logo-icon {
        font-size: 2rem;
        color: var(--accent);
      }

      .logo-text {
        font-family: "Montserrat", sans-serif;
        font-size: 1.5rem;
        font-weight: 800;
        background: linear-gradient(to right, var(--accent), var(--success));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .sidebar-menu {
        padding: 1.5rem 0;
      }

      .menu-item {
        display: flex;
        align-items: center;
        padding: 0.8rem 1.5rem;
        margin: 0.5rem 0;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .menu-item:hover,
      .menu-item.active {
        color: white;
        background: rgba(255, 255, 255, 0.1);
      }

      .menu-item.active {
        border-left: 4px solid var(--accent);
      }

      .menu-item:hover::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
        background: var(--accent);
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateY(100%);
        }
        to {
          transform: translateY(0);
        }
      }

      .menu-icon {
        font-size: 1.2rem;
        margin-right: 1rem;
        width: 24px;
        text-align: center;
      }

      .menu-text {
        font-size: 0.95rem;
        font-weight: 500;
      }

      .menu-badge {
        margin-left: auto;
        background: var(--accent);
        color: white;
        font-size: 0.7rem;
        padding: 0.2rem 0.5rem;
        border-radius: 10px;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      /* Main Content Area */
      .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        transition: all 0.3s ease;
      }

      /* Header Styles */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 2rem;
        height: var(--header-height);
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        position: sticky;
        top: 0;
        z-index: 90;
      }

      .header-left {
        display: flex;
        align-items: center;
      }

      .menu-toggle {
        font-size: 1.5rem;
        color: var(--dark);
        cursor: pointer;
        margin-right: 1.5rem;
        transition: all 0.3s ease;
      }

      .menu-toggle:hover {
        color: var(--accent);
      }

      .search-bar {
        position: relative;
        width: 300px;
      }

      .search-bar input {
        width: 100%;
        padding: 0.6rem 1rem 0.6rem 2.5rem;
        border: 1px solid #e0e0e0;
        border-radius: 30px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }

      .search-bar input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(72, 149, 239, 0.2);
      }

      .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }

      .notification-icon,
      .message-icon {
        font-size: 1.2rem;
        color: var(--dark-gray);
        cursor: pointer;
        position: relative;
        transition: all 0.3s ease;
      }

      .notification-icon:hover,
      .message-icon:hover {
        color: var(--accent);
      }

      .notification-badge,
      .message-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--danger);
        color: white;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        font-size: 0.6rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .message-badge {
        background: var(--success);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        position: relative;
      }

      .profile-image {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--accent);
        transition: all 0.3s ease;
      }

      .profile-image:hover {
        transform: scale(1.1);
        box-shadow: 0 0 10px rgba(72, 149, 239, 0.5);
      }

      .profile-name {
        font-weight: 500;
        font-size: 0.9rem;
      }

      .profile-dropdown {
        position: absolute;
        top: 120%;
        right: 0;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        width: 200px;
        overflow: hidden;
        display: none;
        z-index: 100;
        animation: fadeInDown 0.3s ease-out;
      }

      .user-profile:hover .profile-dropdown {
        display: block;
      }

      .dropdown-item {
        padding: 0.8rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: var(--dark-gray);
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .dropdown-item:hover {
        background: #f5f7fa;
        color: var(--accent);
      }

      .dropdown-icon {
        font-size: 0.9rem;
        width: 20px;
        text-align: center;
      }

      /* Content Area */
      .content {
        padding: 2rem;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .page-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--dark);
      }

      .page-actions {
        display: flex;
        gap: 1rem;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.7rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
      }

      .btn-primary {
        background: linear-gradient(to right, var(--primary), var(--accent));
        color: white;
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
      }

      .btn-primary:hover {
        background: linear-gradient(
          to right,
          var(--primary-dark),
          var(--accent)
        );
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
      }

      .btn-outline {
        background: transparent;
        border: 1px solid var(--accent);
        color: var(--accent);
      }

      .btn-outline:hover {
        background: rgba(72, 149, 239, 0.1);
      }

      /* Dashboard Cards */
      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
        background: var(--accent);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .card-title {
        font-size: 0.9rem;
        color: var(--gray);
        font-weight: 500;
      }

      .card-icon {
        font-size: 1.2rem;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(72, 149, 239, 0.1);
        color: var(--accent);
      }

      .card-body {
        margin-bottom: 1rem;
      }

      .card-value {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 0.5rem;
      }

      .card-text {
        font-size: 0.9rem;
        color: var(--gray);
      }

      .card-footer {
        display: flex;
        align-items: center;
        font-size: 0.8rem;
      }

      .card-growth {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        color: var(--success);
        margin-right: 1rem;
      }

      .growth-danger {
        color: var(--danger);
      }

      /* Profile Section */
      .profile-section {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 2rem;
      }

      .profile-card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        text-align: center;
        position: sticky;
        top: calc(var(--header-height) + 2rem);
        height: fit-content;
      }

      .profile-image-lg {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 5px solid var(--accent);
        margin: 0 auto 1.5rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .profile-image-lg:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .profile-name-lg {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--dark);
      }

      .profile-role {
        font-size: 0.9rem;
        color: var(--accent);
        font-weight: 500;
        margin-bottom: 1.5rem;
        padding: 0.3rem 1rem;
        background: rgba(72, 149, 239, 0.1);
        border-radius: 20px;
        display: inline-block;
      }

      .profile-stats {
        display: flex;
        justify-content: space-around;
        margin: 2rem 0;
      }

      .stat-item {
        text-align: center;
      }

      .stat-value {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dark);
      }

      .stat-label {
        font-size: 0.8rem;
        color: var(--gray);
      }

      .profile-bio {
        margin-bottom: 2rem;
        color: var(--gray);
        font-size: 0.9rem;
        line-height: 1.6;
      }

      .social-links {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .social-link {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f5f7fa;
        color: var(--dark-gray);
        transition: all 0.3s ease;
      }

      .social-link:hover {
        background: var(--accent);
        color: white;
        transform: translateY(-3px);
      }

      .profile-details {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .details-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #eee;
      }

      .details-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--dark);
      }

      .details-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
      }

      .detail-item {
        margin-bottom: 1.5rem;
      }

      .detail-label {
        font-size: 0.8rem;
        color: var(--gray);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .detail-value {
        font-size: 1rem;
        font-weight: 500;
        color: var(--dark);
        padding: 0.5rem 0;
        border-bottom: 1px dashed #eee;
      }

      /* Recent Trips Table */
      .recent-trips {
        margin-top: 2rem;
      }

      .table-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: linear-gradient(to right, var(--primary), var(--accent));
        color: white;
      }

      th {
        padding: 1rem;
        text-align: left;
        font-weight: 500;
      }

      tbody tr {
        border-bottom: 1px solid #eee;
        transition: all 0.3s ease;
      }

      tbody tr:hover {
        background: #f9f9f9;
      }

      td {
        padding: 1rem;
        color: var(--dark-gray);
      }

      .status {
        padding: 0.3rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .status-completed {
        background: rgba(76, 201, 240, 0.1);
        color: var(--success);
      }

      .status-pending {
        background: rgba(248, 150, 30, 0.1);
        color: var(--warning);
      }

      .status-cancelled {
        background: rgba(247, 37, 133, 0.1);
        color: var(--danger);
      }

      .action-btn {
        padding: 0.3rem 0.75rem;
        border-radius: 5px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        background: rgba(72, 149, 239, 0.1);
        color: var(--accent);
      }

      .action-btn:hover {
        background: var(--accent);
        color: white;
      }

      /* Vehicle Section */
      .vehicle-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
      }

      .vehicle-card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .vehicle-image-container {
        text-align: center;
        margin-bottom: 1.5rem;
      }

      .vehicle-image {
        max-width: 100%;
        max-height: 200px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .document-image {
        max-width: 100%;
        max-height: 300px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
      }

      /* Settings Section */
      .settings-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      .settings-card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .settings-group {
        margin-bottom: 2rem;
      }

      .settings-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #eee;
      }

      .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid #f5f5f5;
      }

      .setting-label {
        font-weight: 500;
        color: var(--dark-gray);
      }

      .setting-control {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .toggle-slider {
        background-color: var(--accent);
      }

      input:checked + .toggle-slider:before {
        transform: translateX(26px);
      }

      /* Responsive Styles */
      @media (max-width: 1200px) {
        .profile-section,
        .vehicle-section {
          grid-template-columns: 1fr;
        }

        .profile-card {
          position: static;
        }
      }

      @media (max-width: 992px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .content {
          padding: 1.5rem;
        }
      }

      @media (max-width: 768px) {
        .header {
          padding: 0 1rem;
        }

        .search-bar {
          width: 200px;
        }

        .profile-name {
          display: none;
        }

        .details-grid {
          grid-template-columns: 1fr;
        }

        .dashboard-cards {
          grid-template-columns: 1fr 1fr;
        }
      }

      @media (max-width: 576px) {
        .dashboard-cards {
          grid-template-columns: 1fr;
        }

        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 1rem;
        }

        .vehicle-section {
          grid-template-columns: 1fr;
        }
      }

      /* Animations */
      .animate-bounce {
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .animate-float {
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-15px);
        }
      }

      /* Tabs */
      .tabs {
        display: flex;
        border-bottom: 1px solid #eee;
        margin-bottom: 1.5rem;
      }

      .tab {
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        font-weight: 500;
        color: var(--gray);
        position: relative;
        transition: all 0.3s ease;
      }

      .tab:hover {
        color: var(--accent);
      }

      .tab.active {
        color: var(--accent);
      }

      .tab.active::after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--accent);
        border-radius: 3px 3px 0 0;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Ride Alerts Container */
      .ride-alerts {
        background: linear-gradient(135deg, #f5f7fa 0%, #e2e8f0 100%);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05),
          inset 0 1px 0 rgba(255, 255, 255, 0.8);
        position: relative;
        overflow: hidden;
      }

      .ride-alerts::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(72, 149, 239, 0.1) 0%,
          transparent 70%
        );
        z-index: 0;
      }

      /* Request Container - Enhanced 3D Effect */
      .request-container {
        background: linear-gradient(135deg rgb(170, 170, 253)), white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1),
          0 1px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
        position: relative;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .request-container:hover {
        transform: translateY(-5px) rotateX(2deg);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15),
          0 5px 15px rgba(72, 149, 239, 0.2);
      }

      .request-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 8px;
        background: var(--gradient-primary);
        border-radius: 16px 16px 0 0;
        opacity: 0.8;
      }

      /* Header Bar with Glassmorphism Effect */
      .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        position: relative;
      }

      .header-bar h2 {
        font-size: 1.4rem;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin: 0;
        font-weight: 700;
        letter-spacing: -0.5px;
      }

      .header-bar h2 i {
        color: var(--accent);
        font-size: 1.3em;
        text-shadow: 0 2px 4px rgba(72, 149, 239, 0.3);
      }

      /* Notification Bell with Animation */
      .notification-bell {
        position: relative;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(72, 149, 239, 0.1);
        color: var(--accent);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .notification-bell:hover {
        background: rgba(72, 149, 239, 0.2);
        transform: translateY(-2px);
        animation: ring 0.5s ease;
      }

      @keyframes ring {
        0% {
          transform: rotate(0deg);
        }
        25% {
          transform: rotate(15deg);
        }
        50% {
          transform: rotate(-15deg);
        }
        75% {
          transform: rotate(10deg);
        }
        100% {
          transform: rotate(0deg);
        }
      }

      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--gradient-danger);
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(247, 37, 133, 0.3);
      }

      /* Request Cards - Modern Design */
      .request-card {
        background: #f7edb5;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.25rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
        transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.03);
      }

      .request-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.08),
          0 5px 15px rgba(72, 149, 239, 0.1);
      }

      .request-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--gradient-accent);
        transition: all 0.3s ease;
      }

      .request-card:hover::before {
        width: 6px;
      }

      .request-card .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.25rem;
        border-radius: 15px;
        background-color: cadetblue;
      }

      .request-card .header h3 {
        font-size: 1.1rem;
        color: var(--dark);
        font-weight: 600;
        margin: 0;
      }

      .request-card .header .badge {
        background: var(--gradient-primary);
        color: white;
        padding: 0.35rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(67, 97, 238, 0.3);
      }

      .request-card .preview-content {
        display: flex;
        align-items: center;
        gap: 1.25rem;
      }

      .request-card .preview-content .rider-image {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1), 0 0 0 3px var(--accent);
        transition: all 0.3s ease;
      }

      .request-card:hover .preview-content .rider-image {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 0 0 3px var(--accent);
      }

      .request-card .preview-content .details p {
        font-size: 0.95rem;
        color: var(--dark-gray);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .request-card .preview-content .details p i {
        color: var(--accent);
        font-size: 1rem;
        width: 20px;
        text-align: center;
      }

      .request-card .preview-content .fare {
        margin-left: auto;
        text-align: right;
      }

      .request-card .preview-content .fare .amount {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 0.25rem;
        background: linear-gradient(to right, var(--primary), var(--accent));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .request-card .preview-content .fare .distance {
        font-size: 0.85rem;
        color: var(--gray);
        font-weight: 500;
      }

      /* Enhanced 3D Expanded Card */
      .expanded-card {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.4s ease;
        backdrop-filter: blur(8px);
        border-radius: 15px;
      }

      .expanded-card.active {
        opacity: 1;
        pointer-events: all;
      }

      .card-3d {
        width: 90%;
        max-width: 480px;
        max-height: 620px;
        overflow-y: auto;
        background: linear-gradient(145deg, #2c3e50, #34495e);
        border-radius: var(--border-radius);
        padding: 20px;
        transform-style: preserve-3d;
        transform: rotateY(180deg) scale(0.8);
        transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .expanded-card.active .card-3d {
        transform: rotateY(0) scale(1);
      }

      .card-3d::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.03),
          transparent
        );
        transform: rotate(45deg);
        animation: holographic 8s infinite linear;
      }

      @keyframes holographic {
        0% {
          transform: translateX(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) rotate(45deg);
        }
      }

      .card-3d .back-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.1);
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .card-3d .back-btn:hover {
        background: var(--primary-color);
        transform: rotate(-15deg);
      }

      .card-3d .rider-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
        position: relative;
        z-index: 5;
      }

      .card-3d .rider-header .rider-image {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--primary-color);
        box-shadow: 0 0 25px rgba(52, 152, 219, 0.6);
        transform: translateZ(30px);
        transition: all 0.3s ease;
      }

      .card-3d .rider-header .rider-info h2 {
        color: white;
        font-size: 20px;
        margin-bottom: 8px;
        transform: translateZ(20px);
        font-weight: 600;
      }

      .card-3d .details-section {
        background: rgba(0, 0, 0, 0.25);
        border-radius: var(--border-radius);
        padding: 15px;
        margin-bottom: 15px;
        position: relative;
        z-index: 5;
        transform: translateZ(10px);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .card-3d .details-section .detail-item {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
        color: var(--light-color);
      }

      .card-3d .details-section .detail-item:last-child {
        margin-bottom: 0;
      }

      .card-3d .details-section .detail-item i {
        color: var(--primary-color);
        font-size: 16px;
        width: 20px;
        text-align: center;
        opacity: 0.8;
      }

      .card-3d .details-section .detail-item .label {
        font-size: 13px;
        opacity: 0.7;
        width: 80px;
        font-weight: 500;
      }

      .card-3d .details-section .detail-item .value {
        font-size: 14px;
        font-weight: 500;
        flex: 1;
        opacity: 0.95;
      }

      .card-3d .vehicle-display {
        background: rgba(0, 0, 0, 0.25);
        border-radius: var(--border-radius);
        padding: 12px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
        z-index: 5;
        transform: translateZ(15px);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .card-3d .vehicle-display .vehicle-icon {
        font-size: 36px;
        color: var(--secondary-color);
        opacity: 0.9;
      }

      .card-3d .vehicle-display .vehicle-info h3 {
        color: var(--light-color);
        font-size: 16px;
        margin-bottom: 5px;
        font-weight: 600;
      }

      .card-3d .vehicle-display .vehicle-info p {
        color: rgba(255, 255, 255, 0.6);
        font-size: 13px;
      }

      .card-3d .vehicle-display .seats-info {
        margin-left: auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .card-3d .vehicle-display .seats-info .seats-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 11px;
      }

      .card-3d .vehicle-display .seats-info .seats {
        display: flex;
        gap: 5px;
      }

      .card-3d .vehicle-display .seats-info .seats .seat {
        width: 14px;
        height: 14px;
        border-radius: 3px;
        background: var(--secondary-color);
        opacity: 0.8;
        position: relative;
      }

      .card-3d .vehicle-display .seats-info .seats .seat.occupied::after {
        content: "×";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 10px;
        font-weight: bold;
      }

      .card-3d .vehicle-display .seats-info .seats .seat.occupied {
        background: var(--danger-color);
      }

      /* Enhanced Fare Update Section */
      .card-3d .fare-section {
        background: rgba(0, 0, 0, 0.25);
        border-radius: var(--border-radius);
        padding: 15px;
        margin-bottom: 20px;
        position: relative;
        z-index: 5;
        transform: translateZ(20px);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .card-3d .fare-section h3 {
        color: var(--light-color);
        font-size: 15px;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }

      .card-3d .fare-section h3 i {
        color: var(--accent-color);
      }

      .card-3d .fare-section .fare-update {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .card-3d .fare-section .current-fare {
        flex: 1;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 8px;
        padding: 10px;
        display: flex;
        flex-direction: column;
      }

      .card-3d .fare-section .current-fare .label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 12px;
        margin-bottom: 5px;
      }

      .card-3d .fare-section .current-fare .amount {
        color: var(--accent-color);
        font-size: 20px;
        font-weight: 700;
      }

      .card-3d .fare-section .new-fare {
        flex: 1;
        position: relative;
      }

      .card-3d .fare-section .new-fare input {
        width: 100%;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 10px 15px 10px 50px;
        color: white;
        font-size: 15px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .card-3d .fare-section .new-fare input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      }

      .card-3d .fare-section .new-fare::before {
        content: "PKR";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.6);
        font-size: 14px;
        font-weight: 600;
      }

      /* Refined Action Buttons */
      .card-3d .action-buttons {
        display: flex;
        gap: 12px;
        position: relative;
        z-index: 5;
        transform: translateZ(25px);
      }

      .card-3d .action-buttons button {
        flex: 1;
        padding: 14px;
        border-radius: var(--border-radius);
        border: none;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        letter-spacing: 0.5px;
      }

      .card-3d .action-buttons .cancel-btn {
        background: rgba(231, 76, 60, 0.15);
        color: var(--danger-color);
        border: 1px solid rgba(231, 76, 60, 0.3);
      }

      .card-3d .action-buttons .cancel-btn:hover {
        background: var(--danger-color);
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(231, 76, 60, 0.3);
        border-color: transparent;
      }

      .card-3d .action-buttons .accept-btn {
        background: rgba(46, 204, 113, 0.15);
        color: var(--success-color);
        border: 1px solid rgba(46, 204, 113, 0.3);
      }

      .card-3d .action-buttons .accept-btn:hover {
        background: var(--success-color);
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(46, 204, 113, 0.3);
        border-color: transparent;
      }

      .acceptance-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 1rem 2rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        z-index: 1100;
        opacity: 0;
        pointer-events: none;
        transition: all 0.3s ease;
      }

      .acceptance-popup.active {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      .acceptance-popup i {
        font-size: 1.5rem;
        color: var(--success);
      }
      /* Notification Dropdown - Modern */
      .notification-dropdown {
        position: absolute;
        top: 120%;
        right: 0;
        background: white;
        border-radius: 16px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),
          0 5px 15px rgba(0, 0, 0, 0.05);
        width: 350px;
        max-height: 560px;

        display: none;
        z-index: 100;
        transform-origin: top right;
        transform: scale(0.8);
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .notification-dropdown.show {
        display: block;
        transform: scale(1);
        opacity: 1;
      }

      .notification-header {
        padding: 1.25rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        border-radius: 16px 16px 0 0;
      }

      .notification-header h3 {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--dark);
        margin: 0;
      }

      .clear-btn {
        background: rgba(72, 149, 239, 0.1);
        border: none;
        color: var(--accent);
        font-size: 0.85rem;
        padding: 0.35rem 1rem;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .clear-btn:hover {
        background: rgba(72, 149, 239, 0.2);
      }

      .notification-list {
        padding: 0.75rem;
      }

      .notification-item {
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 0.75rem;
        background: rgba(72, 149, 239, 0.03);
        transition: all 0.3s ease;
        cursor: pointer;
        border: 1px solid rgba(0, 0, 0, 0.03);
      }

      .notification-item:hover {
        background: rgba(72, 149, 239, 0.08);
        transform: translateX(5px);
      }

      .notification-item.unread {
        background: rgba(72, 149, 239, 0.1);
        border-left: 4px solid var(--accent);
      }

      .notification-content {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
      }

      .notification-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid white;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
      }

      .notification-text {
        font-size: 0.95rem;
        color: var(--dark-gray);
        margin-bottom: 0.5rem;
        line-height: 1.4;
      }

      .notification-time {
        font-size: 0.75rem;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .notification-time i {
        font-size: 0.7rem;
      }

      /* Responsive Adjustments */
      @media (max-width: 768px) {
        .ride-alerts {
          padding: 1.5rem;
        }

        .card-3d {
          padding: 1.5rem;
          width: 95%;
        }

        .rider-header {
          flex-direction: column;
          text-align: center;
        }

        .details-section {
          grid-template-columns: 1fr;
        }

        .fare-update {
          flex-direction: column;
        }

        .action-buttons {
          flex-direction: column;
        }

        .notification-dropdown {
          width: 280px;
          right: -50px;
        }
      }

      /* Floating Animation for Cards */
      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .floating-card {
        animation: float 6s ease-in-out infinite;
      }

      /* Glow Effect */
      .glow {
        box-shadow: 0 0 15px rgba(72, 149, 239, 0.5);
      }

      /* Hover Effects */
      .hover-grow {
        transition: transform 0.3s ease;
      }

      .hover-grow:hover {
        transform: scale(1.02);
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 0px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(72, 149, 239, 0.5);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--accent);
      }

      /* 3D Popup Styles */
      .popup-3d-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        pointer-events: none;
        opacity: 0;
        transform: scale(0.5);
        transition: opacity 0.3s, transform 0.3s;
      }

      .popup-3d-container.show {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
      }

      .popup-3d {
        position: relative;
        width: 300px;
        padding: 30px;
        background: linear-gradient(145deg, #ffffff, #f0f0f0);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transform-style: preserve-3d;
        transform: perspective(1000px) rotateY(0deg) rotateX(0deg);
        transition: transform 0.5s;
        text-align: center;
      }

      .popup-3d:hover {
        transform: perspective(1000px) rotateY(5deg) rotateX(5deg);
      }

      .popup-3d-shadow {
        position: absolute;
        bottom: -15px;
        left: 5%;
        width: 90%;
        height: 20px;
        background: rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        filter: blur(10px);
        z-index: -1;
      }

      .popup-content i {
        font-size: 60px;
        margin-bottom: 20px;
        display: none;
      }

      .popup-content .success-icon {
        color: #4caf50;
        display: none;
      }

      .popup-content .error-icon {
        color: #f44336;
        display: none;
      }

      .popup-title {
        margin-bottom: 10px;
        font-size: 22px;
      }

      .popup-message {
        margin-bottom: 20px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="dashboard">
      <!-- Sidebar -->
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <div class="logo-icon"><i class="fas fa-car-side"></i></div>
            <div class="logo-text">DriveWise</div>
          </div>
        </div>
        <div class="sidebar-menu">
          <a href="#" class="menu-item active" data-tab="dashboard">
            <div class="menu-icon"><i class="fas fa-tachometer-alt"></i></div>
            <div class="menu-text">Dashboard</div>
          </a>
          <a href="#" class="menu-item" data-tab="ride-alerts">
            <div class="menu-icon"><i class="fas fa-bell"></i></div>
            <div class="menu-text">Ride Alerts</div>
            <div class="menu-badge" id="alertsBadge">0</div>
          </a>
          <a href="#" class="menu-item" data-tab="profile">
            <div class="menu-icon"><i class="fas fa-user"></i></div>
            <div class="menu-text">Profile</div>
          </a>
          <a href="#" class="menu-item" data-tab="trips">
            <div class="menu-icon"><i class="fas fa-route"></i></div>
            <div class="menu-text">Trips</div>
            <div class="menu-badge" id="tripsBadge">0</div>
          </a>
          <a href="#" class="menu-item" data-tab="vehicles">
            <div class="menu-icon"><i class="fas fa-car"></i></div>
            <div class="menu-text">Vehicles</div>
          </a>
          <a href="#" class="menu-item" data-tab="settings">
            <div class="menu-icon"><i class="fas fa-cog"></i></div>
            <div class="menu-text">Settings</div>
          </a>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Header -->
        <header class="header">
          <div class="header-left">
            <div class="menu-toggle" id="menuToggle">
              <i class="fas fa-bars"></i>
            </div>
            <div class="search-bar">
              <i class="fas fa-search search-icon"></i>
              <input type="text" placeholder="Search..." />
            </div>
          </div>
          <div class="header-right">
            <div class="notification-container">
              <div id="notificationBell" class="notification-bell">
                <i class="fas fa-bell"></i>
                <span id="notificationBadge" class="notification-badge"></span>
              </div>
            </div>
            <div class="user-profile">
              <img
                src="https://via.placeholder.com/150"
                alt="Profile"
                class="profile-image"
                id="headerProfileImage"
              />
              <div class="profile-name" id="headerProfileName"></div>
              <div class="profile-dropdown">
                <a href="#" class="dropdown-item" data-tab="profile">
                  <div class="dropdown-icon"><i class="fas fa-user"></i></div>
                  <div>Profile</div>
                </a>
                <a href="#" class="dropdown-item" data-tab="settings">
                  <div class="dropdown-icon"><i class="fas fa-cog"></i></div>
                  <div>Settings</div>
                </a>
                <a href="#" class="dropdown-item" id="logoutBtn">
                  <div class="dropdown-icon">
                    <i class="fas fa-sign-out-alt"></i>
                  </div>
                  <div>Logout</div>
                </a>
              </div>
            </div>
          </div>
        </header>

        <!-- Content Area -->
        <div class="content">
          <!-- Dashboard Tab -->
          <div class="tab-content active" id="dashboard-tab">
            <div class="page-header">
              <h1 class="page-title">Dashboard</h1>
            </div>

            <!-- Dashboard Cards -->
            <div class="dashboard-cards">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">Total Earnings</div>
                  <div class="card-icon">
                    <i class="fas fa-wallet"></i>
                  </div>
                </div>
                <div class="card-body">
                  <div class="card-value" id="totalEarnings">$0.00</div>
                  <div class="card-text">This month</div>
                </div>
                <div class="card-footer">
                  <div class="card-text">Automatically updated</div>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <div class="card-title">Completed Trips</div>
                  <div class="card-icon">
                    <i class="fas fa-check-circle"></i>
                  </div>
                </div>
                <div class="card-body">
                  <div class="card-value" id="completedTrips">0</div>
                  <div class="card-text">This month</div>
                </div>
                <div class="card-footer">
                  <div class="card-text">Automatically counted</div>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <div class="card-title">Active Hours</div>
                  <div class="card-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                </div>
                <div class="card-body">
                  <div class="card-value" id="activeHours">0.0</div>
                  <div class="card-text">This session</div>
                </div>
                <div class="card-footer">
                  <div class="card-text">Tracking since login</div>
                </div>
              </div>
              <div class="card">
                <div class="card-header">
                  <div class="card-title">Rating</div>
                  <div class="card-icon">
                    <i class="fas fa-star"></i>
                  </div>
                </div>
                <div class="card-body">
                  <div class="card-value" id="driverRating">0.0</div>
                  <div class="card-text" id="ratingCount">From 0 reviews</div>
                </div>
                <div class="card-footer">
                  <div class="card-text">Based on rider feedback</div>
                </div>
              </div>
            </div>

            <!-- Recent Trips -->
            <div class="recent-trips">
              <h2 class="section-title">Recent Trips</h2>
              <div class="table-container">
                <table id="recentTripsTable">
                  <thead>
                    <tr>
                      <th>Trip ID</th>
                      <th>Date</th>
                      <th>Passenger</th>
                      <th>Distance</th>
                      <th>Fare</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="recentTripsBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Trips Tab -->
          <div class="tab-content" id="trips-tab">
            <div class="page-header">
              <h1 class="page-title">All Trips</h1>
            </div>

            <div class="recent-trips">
              <div class="table-container">
                <table id="allTripsTable">
                  <thead>
                    <tr>
                      <th>Trip ID</th>
                      <th>Date</th>
                      <th>Passenger</th>
                      <th>Pickup</th>
                      <th>Dropoff</th>
                      <th>Distance</th>
                      <th>Fare</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="allTripsBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Profile Tab -->
          <div class="tab-content" id="profile-tab">
            <div class="page-header">
              <h1 class="page-title">My Profile</h1>
            </div>

            <div class="profile-section">
              <div class="profile-card">
                <img
                  src="https://via.placeholder.com/150"
                  alt="Profile"
                  class="profile-image-lg"
                  id="profileImage"
                />
                <h2 class="profile-name-lg" id="profileName">John Doe</h2>
                <div class="profile-role">Verified Driver</div>

                <div class="profile-stats">
                  <div class="stat-item">
                    <div class="stat-value" id="profileRating">4.8</div>
                    <div class="stat-label">Rating</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-value" id="profileTrips">48</div>
                    <div class="stat-label">Trips</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-value">2</div>
                    <div class="stat-label">Years</div>
                  </div>
                </div>

                <p class="profile-bio" id="profileBio">
                  Professional driver with 5+ years of experience. Providing
                  safe and comfortable rides for all passengers.
                </p>
              </div>

              <div class="profile-details">
                <div class="details-header">
                  <h2 class="details-title">Personal Information</h2>
                </div>

                <div class="details-grid">
                  <div class="detail-item">
                    <div class="detail-label">Full Name</div>
                    <div class="detail-value" id="detailFullName">
                      John Michael Doe
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value" id="detailEmail">
                      john.doe@example.com
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Date of Birth</div>
                    <div class="detail-value" id="detailDob">15 March 1985</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Gender</div>
                    <div class="detail-value" id="detailGender">Male</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Phone Number</div>
                    <div class="detail-value" id="detailPhone">
                      +1 (555) 123-4567
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">CNIC/NICOP</div>
                    <div class="detail-value" id="detailCnic">
                      12345-6789012-3
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Address</div>
                    <div class="detail-value" id="detailAddress">
                      123 Main Street, Apt 4B, New York, NY 10001
                    </div>
                  </div>
                </div>

                <div class="details-header" style="margin-top: 2rem">
                  <h2 class="details-title">Driver Information</h2>
                </div>

                <div class="details-grid">
                  <div class="detail-item">
                    <div class="detail-label">License Number</div>
                    <div class="detail-value" id="detailLicense">
                      ABC-1234567
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Vehicle Number</div>
                    <div class="detail-value" id="detailVehicle">XYZ-7890</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Vehicle Type</div>
                    <div class="detail-value" id="detailVehicleType">Sedan</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">License Expiry</div>
                    <div class="detail-value" id="detailLicenseExpiry">
                      15 March 2025
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Vehicles Tab -->
          <div class="tab-content" id="vehicles-tab">
            <div class="page-header">
              <h1 class="page-title">My Vehicles</h1>
            </div>

            <div class="vehicle-section">
              <div class="vehicle-card">
                <div class="details-header">
                  <h2 class="details-title">Vehicle Information</h2>
                </div>

                <div class="details-grid">
                  <div class="detail-item">
                    <div class="detail-label">License Number</div>
                    <div class="detail-value" id="detailLicense">
                      PNA-234534
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Vehicle Number</div>
                    <div class="detail-value" id="detailVehicle">CNN-3564</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Vehicle Type</div>
                    <div class="detail-value" id="detailVehicleType">Car</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">License Expiry</div>
                    <div class="detail-value" id="detailLicenseExpiry">
                      15 March 2025
                    </div>
                  </div>
                </div>
              </div>

              <div class="vehicle-card">
                <div class="details-header">
                  <h2 class="details-title">Documents</h2>
                </div>

                <div class="vehicle-image-container">
                  <h3 class="image-title">Driver License</h3>
                  <img
                    src="https://via.placeholder.com/600x400?text=Loading+License..."
                    alt="Driver License"
                    class="document-image"
                    id="licenseImage"
                  />
                </div>

                <div class="vehicle-image-container" style="margin-top: 2rem">
                  <h3 class="image-title">Vehicle Image</h3>
                  <img
                    src="https://via.placeholder.com/600x400?text=Loading+Vehicle..."
                    alt="Vehicle Image"
                    class="document-image"
                    id="vehicleImage"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Ride Alerts Tab -->
          <div class="tab-content" id="ride-alerts-tab">
            <div class="page-header">
              <h1 class="page-title">Ride Alerts</h1>
            </div>

            <div class="ride-alerts">
              <!-- Request Container -->
              <div class="request-container">
                <div class="header-bar">
                  <h2><i class="fas fa-car"></i> Ride Requests</h2>
                </div>
                <div id="requests">
                  <!-- Requests will appear here dynamically -->
                </div>
              </div>

              <!-- Expanded Card View -->
              <div class="expanded-card">
                <div class="card-3d">
                  <button class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                  </button>
                  <div class="rider-header">
                    <img
                      src=""
                      alt="Rider"
                      class="rider-image"
                      id="expandedRiderImage"
                    />
                    <div class="rider-info">
                      <h2 id="expandedRiderName"></h2>
                    </div>
                  </div>
                  <div class="details-section">
                    <div class="detail-item">
                      <i class="fas fa-phone"></i>
                      <span class="label">Phone:</span>
                      <span class="value" id="expandedRiderPhone"></span>
                    </div>
                    <div class="detail-item">
                      <i class="fas fa-map-marker-alt"></i>
                      <span class="label">Pickup:</span>
                      <span class="value" id="expandedPickup"></span>
                    </div>
                    <div class="detail-item">
                      <i class="fas fa-flag"></i>
                      <span class="label">Destination:</span>
                      <span class="value" id="expandedDestination"></span>
                    </div>
                  </div>
                  <div class="vehicle-display">
                    <i class="fas fa-car vehicle-icon" id="vehicleIcon"></i>
                    <div class="vehicle-info">
                      <h3 id="vehicleType"></h3>
                      <p id="vehicleDesc"></p>
                    </div>
                    <div class="seats-info">
                      <span class="seats-label">Seats Available</span>
                      <div class="seats" id="seatsContainer"></div>
                    </div>
                  </div>
                  <div class="fare-section">
                    <h3><i class="fas fa-money-bill-wave"></i> Fare Details</h3>
                    <div class="fare-update">
                      <div class="current-fare">
                        <span class="label">Current Fare</span>
                        <span class="amount" id="currentFare">PKR 0</span>
                      </div>
                      <div class="new-fare">
                        <input
                          type="number"
                          placeholder="0"
                          id="newFareInput"
                          min="0"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="action-buttons">
                    <button class="cancel-btn" id="cancelBtn">
                      <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="accept-btn" id="acceptBtn">
                      <i class="fas fa-check"></i> Accept
                    </button>
                  </div>
                </div>
              </div>

              <!-- 3D Animated Popup -->
              <div class="popup-3d-container">
                <div class="popup-3d">
                  <div class="popup-content">
                    <i class="fas fa-check-circle success-icon"></i>
                    <i class="fas fa-times-circle error-icon"></i>
                    <h3 class="popup-title"></h3>
                    <p class="popup-message"></p>
                  </div>
                  <div class="popup-3d-shadow"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div class="tab-content" id="settings-tab">
            <div class="page-header">
              <h1 class="page-title">Settings</h1>
            </div>

            <div class="settings-section">
              <div class="settings-card">
                <div class="settings-group">
                  <h3 class="settings-title">Account Settings</h3>
                  <div class="setting-item">
                    <div class="setting-label">Change Password</div>
                    <div class="setting-control">
                      <button class="btn btn-outline" id="changePasswordBtn">
                        Change
                      </button>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Two-Factor Authentication</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input type="checkbox" id="twoFactorToggle" />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Delete Account</div>
                    <div class="setting-control">
                      <button class="btn btn-outline" id="deleteAccountBtn">
                        Delete
                      </button>
                    </div>
                  </div>
                </div>

                <div class="settings-group">
                  <h3 class="settings-title">Notification Settings</h3>
                  <div class="setting-item">
                    <div class="setting-label">Ride Requests</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input
                          type="checkbox"
                          id="rideRequestsToggle"
                          checked
                        />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Messages</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input type="checkbox" id="messagesToggle" checked />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Promotions</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input type="checkbox" id="promotionsToggle" />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-card">
                <div class="settings-group">
                  <h3 class="settings-title">Appearance</h3>
                  <div class="setting-item">
                    <div class="setting-label">Dark Mode</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input type="checkbox" id="darkModeToggle" />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Font Size</div>
                    <div class="setting-control">
                      <select
                        id="fontSizeSelect"
                        class="form-control"
                        style="width: 100px"
                      >
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="settings-group">
                  <h3 class="settings-title">Privacy</h3>
                  <div class="setting-item">
                    <div class="setting-label">Show Profile to Riders</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input
                          type="checkbox"
                          id="profileVisibilityToggle"
                          checked
                        />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Share Location</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input
                          type="checkbox"
                          id="locationSharingToggle"
                          checked
                        />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Share Trip History</div>
                    <div class="setting-control">
                      <label class="toggle-switch">
                        <input type="checkbox" id="tripHistoryToggle" />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="settings-group">
                  <h3 class="settings-title">About</h3>
                  <div class="setting-item">
                    <div class="setting-label">App Version</div>
                    <div class="setting-control">
                      <span>1.0.0</span>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Terms of Service</div>
                    <div class="setting-control">
                      <button class="btn btn-outline" id="termsBtn">
                        View
                      </button>
                    </div>
                  </div>
                  <div class="setting-item">
                    <div class="setting-label">Privacy Policy</div>
                    <div class="setting-control">
                      <button class="btn btn-outline" id="privacyBtn">
                        View
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ipfs-http-client@56.0.1/dist/index.min.js"></script>
    <script>
      // Configuration
const CONTRACT_ADDRESS = "0xa624AB1344DE2560acF3C5d60DebD6357DbD54D7";
const CONTRACT_ABI = [
  {
    inputs: [
      {
        internalType: "string",
        name: "_email",
        type: "string",
      },
    ],
    name: "getDriverByEmail",
    outputs: [
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "string",
        name: "",
        type: "string",
      },
      {
        internalType: "address",
        name: "",
        type: "address",
      },
    ],
    stateMutability: "view",
    type: "function",
  },
];
const IPFS_NODE_URL = "http://127.0.0.1:5001";

// Application State
let web3;
let contract;
let ipfs;
let currentAccount;
let driverData = null;
let activeHoursInterval;
let loginTime;
let completedTrips = 0;
let totalEarnings = 0;
let ratings = [];
let allTrips = [];
let rideAlerts = [];
let settings = {
  twoFactorAuth: false,
  rideRequests: true,
  messages: true,
  promotions: false,
  darkMode: false,
  fontSize: "medium",
  profileVisibility: true,
  locationSharing: true,
  tripHistory: false,
};

// Initialize the application
document.addEventListener("DOMContentLoaded", async () => {
  try {
    await initApp();
    await loadDriverData();
    loadSavedData();
    setupEventListeners();
    initDashboardMetrics();
    simulateData(); // For demo purposes only
    
    // Store basic profile data in localStorage
    storeProfileDataInLocalStorage();
    
    // Initialize rider data in localStorage
    initRiderDataStorage();
  } catch (error) {
    console.error("Initialization error:", error);
  }
});

// Initialize rider data storage structure
function initRiderDataStorage() {
  if (!localStorage.getItem('riderData')) {
    const initialRiderData = {
      riderRequests: [],
      riderProfiles: {},
      lastUpdated: null
    };
    localStorage.setItem('riderData', JSON.stringify(initialRiderData));
  }
}

// Store rider request in localStorage
function storeRiderRequest(riderRequest) {
  const riderData = JSON.parse(localStorage.getItem('riderData')) || {};
  
  if (!riderData.riderRequests) {
    riderData.riderRequests = [];
  }
  
  // Add timestamp to the request
  riderRequest.timestamp = new Date().toISOString();
  riderRequest.requestId = `rider-req-${Date.now()}`;
  
  riderData.riderRequests.unshift(riderRequest);
  riderData.lastUpdated = new Date().toISOString();
  
  localStorage.setItem('riderData', JSON.stringify(riderData));
  
  return riderRequest.requestId;
}

// Get all rider requests from localStorage
function getAllRiderRequests() {
  const riderData = JSON.parse(localStorage.getItem('riderData')) || {};
  return riderData.riderRequests || [];
}

// Get specific rider request by ID
function getRiderRequestById(requestId) {
  const riderData = JSON.parse(localStorage.getItem('riderData')) || {};
  return (riderData.riderRequests || []).find(req => req.requestId === requestId);
}

// Update rider request status
function updateRiderRequestStatus(requestId, status) {
  const riderData = JSON.parse(localStorage.getItem('riderData')) || {};
  
  if (riderData.riderRequests) {
    const requestIndex = riderData.riderRequests.findIndex(req => req.requestId === requestId);
    if (requestIndex !== -1) {
      riderData.riderRequests[requestIndex].status = status;
      riderData.riderRequests[requestIndex].updatedAt = new Date().toISOString();
      localStorage.setItem('riderData', JSON.stringify(riderData));
      return true;
    }
  }
  return false;
}

// Store rider profile information
function storeRiderProfile(riderId, profileData) {
  const riderData = JSON.parse(localStorage.getItem('riderData')) || {};
  
  if (!riderData.riderProfiles) {
    riderData.riderProfiles = {};
  }
  
  profileData.lastUpdated = new Date().toISOString();
  riderData.riderProfiles[riderId] = profileData;
  riderData.lastUpdated = new Date().toISOString();
  
  localStorage.setItem('riderData', JSON.stringify(riderData));
}

// Get rider profile by ID
function getRiderProfile(riderId) {
  const riderData = JSON.parse(localStorage.getItem('riderData')) || {};
  return riderData.riderProfiles ? riderData.riderProfiles[riderId] : null;
}

// Clear all rider data (for testing/debugging)
function clearAllRiderData() {
  localStorage.removeItem('riderData');
  initRiderDataStorage();
}

// Example function to handle new rider request
function handleNewRiderRequest(riderInfo) {
  // Store the rider request
  const requestId = storeRiderRequest({
    riderId: riderInfo.id,
    name: riderInfo.name,
    pickupLocation: riderInfo.pickup,
    destination: riderInfo.destination,
    distance: riderInfo.distance,
    fareEstimate: riderInfo.fare,
    status: 'pending',
    createdAt: new Date().toISOString()
  });
  
  // Store/update rider profile if needed
  if (!getRiderProfile(riderInfo.id)) {
    storeRiderProfile(riderInfo.id, {
      name: riderInfo.name,
      phone: riderInfo.phone || '',
      rating: riderInfo.rating || null,
      tripCount: riderInfo.tripCount || 0,
      preferredPayment: riderInfo.paymentMethod || 'cash'
    });
  }
  
  return requestId;
}

// Store profile data in localStorage
function storeProfileDataInLocalStorage() {
  if (!driverData) return;

  const profileData = {
    name: driverData.driverName || "Driver",
    phone: driverData.phone || "N/A",
    profileImage: driverData.profileImage || "https://via.placeholder.com/150",
    lastUpdated: new Date().toISOString()
  };

  localStorage.setItem("driverProfileData", JSON.stringify(profileData));
  console.log("Profile data stored in localStorage:", profileData);
}

// Get profile data from localStorage
function getProfileDataFromLocalStorage() {
  const profileData = JSON.parse(localStorage.getItem("driverProfileData"));
  console.log("Profile data retrieved from localStorage:", profileData);
  return profileData || null;
}

// Initialize dashboard metrics
function initDashboardMetrics() {
  startTrackingActiveHours();
  updateDashboardMetrics();
}

// Load saved data from localStorage
function loadSavedData() {
  const savedMetrics = JSON.parse(localStorage.getItem("driverMetrics")) || {};
  completedTrips = savedMetrics.completedTrips || 0;
  totalEarnings = savedMetrics.totalEarnings || 0;
  ratings = savedMetrics.ratings || [];
  allTrips = savedMetrics.allTrips || [];
  rideAlerts = savedMetrics.rideAlerts || [];

  const savedSettings = JSON.parse(localStorage.getItem("driverSettings")) || {};
  settings = { ...settings, ...savedSettings };

  // Load profile data from localStorage if available
  const savedProfile = getProfileDataFromLocalStorage();
  if (savedProfile) {
    const safeSetText = (id, text) => {
      const el = document.getElementById(id);
      if (el) el.textContent = text;
    };
    
    const safeSetImage = (id, src) => {
      const el = document.getElementById(id);
      if (el) el.src = src;
    };

    safeSetText("profileName", savedProfile.name);
    safeSetText("headerProfileName", savedProfile.name);
    safeSetText("detailFullName", savedProfile.name);
    safeSetText("detailPhone", savedProfile.phone);
    
    safeSetImage("profileImage", savedProfile.profileImage);
    safeSetImage("headerProfileImage", savedProfile.profileImage);
  }

  updateSettingsUI();
}

// Save data to localStorage
function saveData() {
  const metrics = {
    completedTrips,
    totalEarnings,
    ratings,
    allTrips,
    rideAlerts,
  };
  localStorage.setItem("driverMetrics", JSON.stringify(metrics));
  localStorage.setItem("driverSettings", JSON.stringify(settings));
}

// Update dashboard metrics UI
function updateDashboardMetrics() {
  const safeSetText = (id, text) => {
    const el = document.getElementById(id);
    if (el) el.textContent = text;
  };

  safeSetText("completedTrips", completedTrips);
  safeSetText("tripsBadge", completedTrips);
  safeSetText("totalEarnings", `$${totalEarnings.toFixed(2)}`);

  const avgRating = ratings.length > 0
    ? ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length
    : 0;

  safeSetText("driverRating", avgRating.toFixed(1));
  safeSetText("ratingCount", `From ${ratings.length} reviews`);
  safeSetText("profileRating", avgRating.toFixed(1));
  safeSetText("profileTrips", completedTrips);

  updateTripsTables();

  const rideAlertsTab = document.getElementById("ride-alerts-tab");
  if (rideAlertsTab && rideAlertsTab.classList.contains("active")) {
    updateAlerts();
  }
}

// Start tracking active hours
function startTrackingActiveHours() {
  loginTime = new Date();
  const activeHoursEl = document.getElementById("activeHours");
  if (activeHoursEl) activeHoursEl.textContent = "0.0";

  activeHoursInterval = setInterval(() => {
    const now = new Date();
    const hours = (now - loginTime) / (1000 * 60 * 60);
    if (activeHoursEl) activeHoursEl.textContent = hours.toFixed(1);
  }, 60000);
}

// Update trips tables
function updateTripsTables() {
  updateRecentTripsTable();
  updateAllTripsTable();
}

function updateRecentTripsTable() {
  const tbody = document.getElementById("recentTripsBody");
  if (!tbody) return;

  tbody.innerHTML = "";

  const sortedTrips = [...allTrips].sort(
    (a, b) => new Date(b.date) - new Date(a.date)
  );

  const tripsToShow = sortedTrips.slice(0, 5);

  tripsToShow.forEach((trip) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${trip.id}</td>
      <td>${formatDate(trip.date)}</td>
      <td>${trip.passenger}</td>
      <td>${trip.distance} km</td>
      <td>$${trip.fare.toFixed(2)}</td>
      <td><span class="status status-completed">Completed</span></td>
    `;
    tbody.appendChild(row);
  });
}

function updateAllTripsTable() {
  const tbody = document.getElementById("allTripsBody");
  if (!tbody) return;

  tbody.innerHTML = "";

  const sortedTrips = [...allTrips].sort(
    (a, b) => new Date(b.date) - new Date(a.date)
  );

  sortedTrips.forEach((trip) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${trip.id}</td>
      <td>${formatDate(trip.date)}</td>
      <td>${trip.passenger}</td>
      <td>${trip.pickup}</td>
      <td>${trip.dropoff}</td>
      <td>${trip.distance} km</td>
      <td>$${trip.fare.toFixed(2)}</td>
      <td><span class="status status-completed">Completed</span></td>
    `;
    tbody.appendChild(row);
  });
}

// Update alerts
function updateAlerts() {
  const container = document.getElementById("alertsContainer");
  if (!container) return;

  container.innerHTML = "";

  const sortedAlerts = [...rideAlerts].sort(
    (a, b) => new Date(b.time) - new Date(a.time)
  );

  const unreadCount = rideAlerts.filter((alert) => !alert.read).length;
  const alertsBadge = document.getElementById("alertsBadge");
  const alertsIconBadge = document.getElementById("alertsIconBadge");

  if (alertsBadge) alertsBadge.textContent = unreadCount;
  if (alertsIconBadge) alertsIconBadge.textContent = unreadCount;

  sortedAlerts.forEach((alert) => {
    const alertElement = document.createElement("div");
    alertElement.className = `alert-item ${alert.read ? "" : "unread"}`;
    alertElement.innerHTML = `
      <div class="alert-content">
        <div class="alert-title">${
          alert.type === "ride" ? "New Ride Request" : "System Notification"
        }</div>
        <div class="alert-message">${alert.message}</div>
        <div class="alert-time">${formatTime(alert.time)}</div>
      </div>
      <div class="alert-actions">
        ${
          alert.type === "ride"
            ? `
          <button class="btn btn-primary accept-btn" data-id="${alert.id}">Accept</button>
          <button class="btn btn-outline reject-btn" data-id="${alert.id}">Reject</button>
          `
            : ""
        }
      </div>
    `;
    container.appendChild(alertElement);
  });
}

// Format date for display
function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}

// Format time for display
function formatTime(dateString) {
  const date = new Date(dateString);
  return date.toLocaleTimeString("en-US", {
    hour: "2-digit",
    minute: "2-digit",
    hour12: true,
  });
}

// Add a completed trip
function addCompletedTrip(trip) {
  completedTrips++;
  totalEarnings += trip.fare;
  allTrips.push(trip);
  saveData();
  updateDashboardMetrics();
}

// Add a new rating
function addRating(rating) {
  ratings.push(rating);
  saveData();
  updateDashboardMetrics();
}

// Add a new ride alert
function addRideAlert(alert) {
  rideAlerts.unshift(alert);
  saveData();
  updateDashboardMetrics();

  // Also store the rider request in localStorage
  if (alert.type === "ride") {
    const riderInfo = {
      id: `rider-${Date.now()}`,
      name: alert.passenger || "Unknown Rider",
      pickup: alert.location || "Unknown Location",
      destination: "Unknown", // You would get this from actual data
      distance: alert.distance || 0,
      fare: alert.fare || 0, // You might need to calculate this
      status: "pending"
    };
    
    handleNewRiderRequest(riderInfo);
  }

  if (Notification.permission === "granted") {
    new Notification("New Ride Alert", {
      body: alert.message,
    });
  }
}

// Mark alert as read
function markAlertAsRead(alertId) {
  const alert = rideAlerts.find((a) => a.id === alertId);
  if (alert) {
    alert.read = true;
    saveData();
    updateDashboardMetrics();
  }
}

// Update settings UI
function updateSettingsUI() {
  const safeSetChecked = (id, checked) => {
    const el = document.getElementById(id);
    if (el) el.checked = checked;
  };

  const safeSetValue = (id, value) => {
    const el = document.getElementById(id);
    if (el) el.value = value;
  };

  safeSetChecked("twoFactorToggle", settings.twoFactorAuth);
  safeSetChecked("rideRequestsToggle", settings.rideRequests);
  safeSetChecked("messagesToggle", settings.messages);
  safeSetChecked("promotionsToggle", settings.promotions);
  safeSetChecked("darkModeToggle", settings.darkMode);
  safeSetValue("fontSizeSelect", settings.fontSize);
  safeSetChecked("profileVisibilityToggle", settings.profileVisibility);
  safeSetChecked("locationSharingToggle", settings.locationSharing);
  safeSetChecked("tripHistoryToggle", settings.tripHistory);

  document.body.classList.toggle("dark-mode", settings.darkMode);

  document.body.style.fontSize =
    settings.fontSize === "small"
      ? "14px"
      : settings.fontSize === "large"
      ? "18px"
      : "12px";
}

// Simulate data for demo purposes
function simulateData() {
  if (allTrips.length === 0) {
    const demoPassengers = [
      "Sarah Johnson",
      "Michael Brown",
      "Emily Davis",
      "Robert Wilson",
      "Jennifer Lee",
    ];
    const demoPickups = [
      "123 Main St",
      "456 Oak Ave",
      "789 Pine Blvd",
      "321 Elm St",
      "654 Maple Ave",
    ];
    const demoDropoffs = [
      "Central Park",
      "Downtown Mall",
      "Airport Terminal",
      "University Campus",
      "Train Station",
    ];
    const demoDistances = [5.2, 8.7, 3.5, 12.3, 6.8];
    const demoFares = [12.5, 18.3, 9.2, 24.1, 15.6];

    demoPassengers.forEach((passenger, index) => {
      const tripDate = new Date();
      tripDate.setDate(tripDate.getDate() - (demoPassengers.length - index));
      addCompletedTrip({
        id: `#TR-${Math.floor(10000 + Math.random() * 90000)}`,
        date: tripDate.toISOString(),
        passenger,
        pickup: demoPickups[index],
        dropoff: demoDropoffs[index],
        distance: demoDistances[index],
        fare: demoFares[index],
      });
    });
  }

  if (ratings.length === 0) {
    for (let i = 0; i < 10; i++) {
      addRating((Math.random() * 2 + 3).toFixed(1));
    }
  }

  if (rideAlerts.length === 0) {
    const demoLocations = [
      "Downtown",
      "Airport",
      "University",
      "Mall",
      "Hospital",
    ];
    const demoPassengers = ["Alex", "Jordan", "Taylor", "Casey", "Riley"];

    demoPassengers.forEach((passenger, index) => {
      const alertTime = new Date();
      alertTime.setMinutes(alertTime.getMinutes() - (demoPassengers.length - index) * 15);
      addRideAlert({
        id: `alert-${Date.now()}-${index}`,
        type: "ride",
        message: `Ride request from ${passenger} at ${demoLocations[index]}`,
        time: alertTime.toISOString(),
        read: index > 2,
        passenger,
        location: demoLocations[index],
        distance: (Math.random() * 10 + 2).toFixed(1),
      });
    });
  }
}

async function initApp() {
  if (window.ethereum) {
    try {
      await window.ethereum.request({ method: "eth_requestAccounts" });
      web3 = new Web3(window.ethereum);
      contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
      const accounts = await web3.eth.getAccounts();
      currentAccount = accounts[0];

      try {
        if (!window.IpfsHttpClient) {
          const script = document.createElement("script");
          script.src = "https://cdn.jsdelivr.net/npm/ipfs-http-client/dist/index.min.js";
          script.onload = async () => {
            try {
              ipfs = await initIPFS();
            } catch (ipfsError) {
              console.warn("IPFS initialization warning:", ipfsError);
            }
          };
          document.head.appendChild(script);
        } else {
          ipfs = await initIPFS();
        }
      } catch (ipfsError) {
        console.warn("IPFS initialization warning:", ipfsError);
      }

      window.ethereum.on("accountsChanged", handleAccountsChanged);
      if (Notification.permission !== "granted") {
        Notification.requestPermission();
      }
    } catch (error) {
      console.error("Web3 initialization error:", error);
      throw error;
    }
  } else {
    throw new Error("Please install MetaMask to use this application.");
  }
}

async function initIPFS() {
  try {
    const ipfsClient = await window.IpfsHttpClient.create({
      host: "127.0.0.1",
      port: 5001,
      protocol: "http",
    });
    const version = await ipfsClient.version();
    console.log("Connected to IPFS node version:", version.version);
    return ipfsClient;
  } catch (error) {
    console.error("IPFS initialization error:", error);
    throw new Error(
      "Failed to connect to local IPFS node. Please ensure it's running on port 5001."
    );
  }
}

async function loadDriverData() {
  try {
    const session = localStorage.getItem("driverSession");
    if (!session) {
      window.location.href = "driverLogin.html";
      return;
    }

    const { email, walletAddress } = JSON.parse(session);
    const accounts = await web3.eth.getAccounts();
    if (accounts[0].toLowerCase() !== walletAddress.toLowerCase()) {
      localStorage.removeItem("driverSession");
      window.location.href = "driverLogin.html";
      return;
    }

    const driver = await contract.methods
      .getDriverByEmail(email)
      .call({ from: currentAccount });
    let ipfsData = {};

    if (driver[7] && driver[7] !== "") {
      try {
        if (ipfs) {
          ipfsData = await fetchIPFSData(driver[7]);
        }
        console.log("IPFS data loaded:", ipfsData);

        if (!ipfsData || Object.keys(ipfsData).length === 0) {
          ipfsData = await fetchIPFSViaGateway(driver[7]);
        }

        const licenseImage = document.getElementById("licenseImage");
        const vehicleImage = document.getElementById("vehicleImage");

        if (licenseImage) {
          licenseImage.src =
            ipfsData.licensePicture ||
            "https://via.placeholder.com/600x400?text=No+License+Uploaded";
        }
        if (vehicleImage) {
          vehicleImage.src =
            ipfsData.vehiclePicture ||
            "https://via.placeholder.com/600x400?text=No+Vehicle+Uploaded";
        }
      } catch (ipfsError) {
        console.warn("IPFS data fetch warning:", ipfsError);
        try {
          ipfsData = await fetchIPFSViaGateway(driver[7]);
          const licenseImage = document.getElementById("licenseImage");
          const vehicleImage = document.getElementById("vehicleImage");
          if (licenseImage && ipfsData.licensePicture) {
            licenseImage.src = ipfsData.licensePicture;
          }
          if (vehicleImage && ipfsData.vehiclePicture) {
            vehicleImage.src = ipfsData.vehiclePicture;
          }
        } catch (gatewayError) {
          console.warn("IPFS gateway fetch warning:", gatewayError);
          const licenseImage = document.getElementById("licenseImage");
          const vehicleImage = document.getElementById("vehicleImage");
          if (licenseImage) {
            licenseImage.src =
              "https://via.placeholder.com/600x400?text=License+Not+Found";
          }
          if (vehicleImage) {
            vehicleImage.src =
              "https://via.placeholder.com/600x400?text=Vehicle+Not+Found";
          }
        }
      }
    } else {
      console.log("No IPFS hash found in blockchain data");
      const licenseImage = document.getElementById("licenseImage");
      const vehicleImage = document.getElementById("vehicleImage");
      if (licenseImage) {
        licenseImage.src =
          "https://via.placeholder.com/600x400?text=No+License+Uploaded";
      }
      if (vehicleImage) {
        vehicleImage.src =
          "https://via.placeholder.com/600x400?text=No+Vehicle+Uploaded";
      }
    }

    driverData = {
      email: driver[0],
      passwordHash: driver[1],
      phone: driver[2],
      cnic: driver[3],
      licenseNumber: driver[4],
      vehicleNumber: driver[5],
      address: driver[6],
      ipfsHash: driver[7],
      walletAddress: driver[8],
      ...ipfsData,
    };

    updateProfileUI();
  } catch (error) {
    console.error("Error loading driver data:", error);
    throw new Error("Failed to load driver data. Please try again.");
  }
}

async function fetchIPFSViaGateway(ipfsHash) {
  try {
    const response = await fetch(`http://127.0.0.1:8080/ipfs/${ipfsHash}`);
    if (!response.ok) throw new Error("Failed to fetch from gateway");
    return await response.json();
  } catch (error) {
    console.error("IPFS gateway fetch error:", error);
    throw error;
  }
}

function updateProfileUI() {
  if (!driverData) return;

  const safeSetText = (id, text) => {
    const element = document.getElementById(id);
    if (element) element.textContent = text || "N/A";
  };

  const safeSetImage = (id, src, fallback) => {
    const element = document.getElementById(id);
    if (element) {
      element.onerror = () => {
        if (element.src !== fallback) {
          element.src = fallback;
        }
      };
      element.src = src || fallback;
    }
  };

  const defaultProfileImage = "https://via.placeholder.com/150";
  const defaultLicenseImage = "https://via.placeholder.com/600x400?text=License+Image";
  const defaultVehicleImage = "https://via.placeholder.com/600x400?text=Vehicle+Image";

  safeSetText("profileName", driverData.driverName || "Driver");
  safeSetText("headerProfileName", driverData.driverName || "Driver");
  safeSetText("detailFullName", driverData.driverName || "N/A");
  safeSetText("detailEmail", driverData.email || "N/A");
  safeSetText("detailPhone", driverData.phone || "N/A");
  safeSetText("detailCnic", driverData.cnic || "N/A");
  safeSetText("detailAddress", driverData.address || "N/A");
  safeSetText("detailLicense", driverData.licenseNumber || "N/A");
  safeSetText("detailVehicle", driverData.vehicleNumber || "N/A");
  safeSetText("detailVehicleType", driverData.vehicleType || "N/A");
  safeSetText("vehicleMake", driverData.vehicleMake || "N/A");
  safeSetText("vehicleModel", driverData.vehicleModel || "N/A");
  safeSetText("vehicleYear", driverData.vehicleYear || "N/A");
  safeSetText("vehicleColor", driverData.vehicleColor || "N/A");
  safeSetText("vehiclePlate", driverData.vehicleNumber || "N/A");

  if (driverData.dob) {
    const dob = new Date(driverData.dob);
    safeSetText(
      "detailDob",
      dob.toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      })
    );
  }

  if (driverData.gender) {
    const genderMap = {
      male: "Male",
      female: "Female",
      other: "Other",
    };
    safeSetText("detailGender", genderMap[driverData.gender] || "N/A");
  }

  safeSetImage("profileImage", driverData.profileImage, defaultProfileImage);
  safeSetImage("headerProfileImage", driverData.profileImage, defaultProfileImage);
  safeSetImage("licenseImage", driverData.licenseImage, defaultLicenseImage);
  safeSetImage("vehicleImage", driverData.vehicleImage, defaultVehicleImage);

  if (driverData.bio) {
    safeSetText("profileBio", driverData.bio);
  }
}

async function fetchIPFSData(ipfsHash) {
  try {
    let content = "";
    for await (const chunk of ipfs.cat(ipfsHash)) {
      content += new TextDecoder().decode(chunk);
    }
    return JSON.parse(content);
  } catch (error) {
    console.error("IPFS fetch error:", error);
    throw new Error("Failed to fetch IPFS data");
  }
}

function setupEventListeners() {
  const menuToggle = document.getElementById("menuToggle");
  if (menuToggle) {
    menuToggle.addEventListener("click", () => {
      const sidebar = document.getElementById("sidebar");
      if (sidebar) sidebar.classList.toggle("active");
    });
  }

  document.querySelectorAll(".menu-item").forEach((item) => {
    item.addEventListener("click", function (e) {
      e.preventDefault();
      const tabId = this.getAttribute("data-tab");
      switchTab(tabId);
    });
  });

  document.querySelectorAll(".dropdown-item[data-tab]").forEach((item) => {
    item.addEventListener("click", function (e) {
      e.preventDefault();
      const tabId = this.getAttribute("data-tab");
      switchTab(tabId);
    });
  });

  const rideAlertsIcon = document.getElementById("rideAlertsIcon");
  if (rideAlertsIcon) {
    rideAlertsIcon.addEventListener("click", function (e) {
      e.preventDefault();
      switchTab("ride-alerts");
    });
  }

  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("accept-btn")) {
      const alertId = e.target.getAttribute("data-id");
      markAlertAsRead(alertId);
      show3DPopup(
        "Ride Accepted!",
        "You have accepted the ride request.",
        "success"
      );
      
      // Update rider request status in localStorage
      const alert = rideAlerts.find(a => a.id === alertId);
      if (alert && alert.type === "ride") {
        updateRiderRequestStatus(alert.id, "accepted");
      }
    } else if (e.target.classList.contains("reject-btn")) {
      const alertId = e.target.getAttribute("data-id");
      markAlertAsRead(alertId);
      show3DPopup(
        "Ride Rejected",
        "You have rejected the ride request.",
        "error"
      );
      
      // Update rider request status in localStorage
      const alert = rideAlerts.find(a => a.id === alertId);
      if (alert && alert.type === "ride") {
        updateRiderRequestStatus(alert.id, "rejected");
      }
    }
  });

  function show3DPopup(title, message, type) {
    const popup = document.querySelector(".popup-3d-container");
    const popupTitle = document.querySelector(".popup-title");
    const popupMessage = document.querySelector(".popup-message");
    const successIcon = document.querySelector(".success-icon");
    const errorIcon = document.querySelector(".error-icon");

    popupTitle.textContent = title;
    popupMessage.textContent = message;

    if (type === "success") {
      successIcon.style.display = "block";
      errorIcon.style.display = "none";
    } else {
      successIcon.style.display = "none";
      errorIcon.style.display = "block";
    }

    popup.classList.add("show");

    setTimeout(() => {
      popup.classList.remove("show");
    }, 3000);
  }

  const setupToggle = (id, property) => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener("change", function () {
        settings[property] = this.checked;
        saveData();
        if (id === "darkModeToggle" || id === "fontSizeSelect") {
          updateSettingsUI();
        }
      });
    }
  };

  setupToggle("twoFactorToggle", "twoFactorAuth");
  setupToggle("rideRequestsToggle", "rideRequests");
  setupToggle("messagesToggle", "messages");
  setupToggle("promotionsToggle", "promotions");
  setupToggle("darkModeToggle", "darkMode");
  setupToggle("profileVisibilityToggle", "profileVisibility");
  setupToggle("locationSharingToggle", "locationSharing");
  setupToggle("tripHistoryToggle", "tripHistory");

  const fontSizeSelect = document.getElementById("fontSizeSelect");
  if (fontSizeSelect) {
    fontSizeSelect.addEventListener("change", function () {
      settings.fontSize = this.value;
      saveData();
      updateSettingsUI();
    });
  }

  const setupButton = (id, handler) => {
    const el = document.getElementById(id);
    if (el) el.addEventListener("click", handler);
  };

  setupButton("changePasswordBtn", () =>
    alert("Password change functionality would be implemented here")
  );
  setupButton("deleteAccountBtn", () => {
    if (confirm("Are you sure you want to delete your account? This cannot be undone.")) {
      alert("Account deletion functionality would be implemented here");
    }
  });
  setupButton("termsBtn", () =>
    alert("Terms of service would be displayed here")
  );
  setupButton("privacyBtn", () =>
    alert("Privacy policy would be displayed here")
  );
  setupButton("logoutBtn", logout);

  const totalEarningsEl = document.getElementById("totalEarnings");
  if (totalEarningsEl) {
    totalEarningsEl.addEventListener("click", function () {
      const newEarnings = parseFloat(
        prompt("Update your total earnings:", totalEarnings.toFixed(2))
      );
      if (!isNaN(newEarnings)) {
        totalEarnings = newEarnings;
        saveData();
        updateDashboardMetrics();
      }
    });
  }

  const completedTripsEl = document.getElementById("completedTrips");
  if (completedTripsEl) {
    completedTripsEl.addEventListener("click", function () {
      const passenger = prompt("Passenger name:", "New Passenger");
      if (passenger) {
        const pickup = prompt("Pickup location:", "123 Main St");
        const dropoff = prompt("Dropoff location:", "Central Park");
        const distance = parseFloat(prompt("Trip distance (km):", "5.0"));
        const fare = parseFloat(prompt("Trip fare:", "10.00"));

        if (!isNaN(distance) && !isNaN(fare)) {
          addCompletedTrip({
            id: `#TR-${Math.floor(10000 + Math.random() * 90000)}`,
            date: new Date().toISOString(),
            passenger,
            pickup,
            dropoff,
            distance,
            fare,
          });
        }
      }
    });
  }

  const driverRatingEl = document.getElementById("driverRating");
  if (driverRatingEl) {
    driverRatingEl.addEventListener("click", function () {
      const rating = parseFloat(prompt("New rating (1-5):", "5.0"));
      if (!isNaN(rating)) {
        addRating(Math.min(5, Math.max(1, rating)));
      }
    });
  }

  const alertsBadgeEl = document.getElementById("alertsBadge");
  if (alertsBadgeEl) {
    alertsBadgeEl.addEventListener("click", function (e) {
      e.stopPropagation();
      const passenger = prompt("Passenger name:", "New Rider");
      if (passenger) {
        const location = prompt("Pickup location:", "Downtown");
        const distance = (Math.random() * 10 + 2).toFixed(1);

        addRideAlert({
          id: `alert-${Date.now()}`,
          type: "ride",
          message: `Ride request from ${passenger} at ${location}`,
          time: new Date().toISOString(),
          read: false,
          passenger,
          location,
          distance,
        });
      }
    });
  }

  document.getElementById("notificationBell").addEventListener("click", function (e) {
    e.preventDefault();
    switchTab("ride-alerts");
  });
}

function switchTab(tabId) {
  document.querySelectorAll(".menu-item").forEach((item) => {
    item.classList.remove("active");
    if (item.getAttribute("data-tab") === tabId) {
      item.classList.add("active");
    }
  });

  document.querySelectorAll(".tab-content").forEach((content) => {
    content.classList.remove("active");
    if (content.id === `${tabId}-tab`) {
      content.classList.add("active");
    }
  });

  if (window.innerWidth < 992) {
    const sidebar = document.getElementById("sidebar");
    if (sidebar) sidebar.classList.remove("active");
  }

  if (tabId === "ride-alerts") {
    rideAlerts.forEach((alert) => (alert.read = true));
    saveData();
    updateDashboardMetrics();
  }
}

function handleAccountsChanged(accounts) {
  if (accounts.length === 0) {
    currentAccount = null;
  } else {
    currentAccount = accounts[0];
  }
}

function logout() {
  clearInterval(activeHoursInterval);
  localStorage.removeItem("driverSession");
  window.location.href = "driverLogin.html";
}
</script>
    <script type="module" src="/libp2p/driver.js"></script>
    <script type="module" src="driverpopup.js"></script>
  </body>
</html>
